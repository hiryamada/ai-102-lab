#!meta

{"kernelInfo":{"defaultKernelName":"csharp","items":[{"name":"csharp"},{"name":"fsharp","languageName":"F#","aliases":["f#","fs"]},{"name":"html","languageName":"HTML"},{"name":"http","languageName":"HTTP"},{"name":"javascript","languageName":"JavaScript","aliases":["js"]},{"name":"mermaid","languageName":"Mermaid"},{"name":"pwsh","languageName":"PowerShell","aliases":["powershell"]},{"name":"value"}]}}

#!csharp

Console.WriteLine("hello from C#");

#!pwsh

Write-Host "hello from PowerShell"

#!pwsh

#!set --name username --value @input:"Azure portal用のユーザー名を入力してください"

#!pwsh

#!set --name password --value @input:"Azure portal用のパスワードを入力してください"

#!pwsh

az login -u "$username" -p "$password"

#!pwsh

$group = az group list --query "[].name" -o tsv
$group

#!pwsh

$suffix = "lab" + (Get-Random -Minimum 10000000 -Maximum 99999999)
$suffix

#!pwsh

$oainame = "oai" + $suffix
$storagename = "stor" + $suffix
$aisearchname = "aisearch" + $suffix
$location = "eastus"

#!pwsh

az search service create -n $aisearchname -g $group -l $location `
    --sku free --identity-type SystemAssigned

#!pwsh

$aiseardhresourceid = (az search service show -n $aisearchname -g $group --query 'id' -otsv)

#!pwsh

az identity show --ids $aiseardhresourceid

#!pwsh

az role assignment create `
    --assignee-object-id $aiseardhid `
    --role "Cognitive Services OpeiAI User" `
    --scope $aiseardhid

#!pwsh

az cognitiveservices account create `
  -n $oainame -g $group -l $location --kind "OpenAI" --sku "S0" --custom-domain $oainame

#!pwsh

az cognitiveservices account deployment create `
    -g $group `
    -n $oainame `
    --deployment-name gpt-4o `
    --model-name gpt-4o `
    --model-version 2024-05-13 `
    --model-format OpenAI `
    --sku-name "Standard" `
    --sku-capacity 5

#!pwsh

az cognitiveservices account deployment create `
    -g $group `
    -n $oainame `
    --deployment-name text-embedding-ada-002 `
    --model-name text-embedding-ada-002 `
    --model-version 2 `
    --model-format OpenAI `
    --sku-name "Standard" `
    --sku-capacity 5

#!pwsh

az storage account create -n $storagename -g $group -l $location `
  --sku Standard_LRS --kind StorageV2

#!pwsh

$stkey = (az storage account keys list --account-name $storagename -g $group `
    --query "[?keyName=='key1'].value | [0]" -o tsv)

#!pwsh

az storage container create --name brochures --account-name $storagename --auth-mode key --account-key $stkey

#!pwsh

az storage blob upload-batch --account-name $storagename --account-key $stkey `
  --source brochures --destination brochures
